\newcommand{\note}[1]{\noindent{\color{blue}\textbf{[\footnotesize #1]}}}
\newcommand{\todo}[1]{\noindent\note{\color{red}[\textsc{todo:} #1]}}
\newcommand{\gap}{{\bf\color{red}[...]}\xspace}
\newcommand{\marnote}[1]{{\marginpar{\bf\color{red}[#1]}}}
\newcommand{\vertx}{Vert.x\xspace}
\newcommand{\donated}[1]{\xspace(\emph{donated by #1})}
\newcommand{\boxstart}{\textbf{\proj will}\xspace}
\newcommand{\dontcount}{\addtocounter{table}{-1}}

\newcommand{\sample}[1]{{\leavevmode\color{red}[#1]}}
\newcommand{\rewrite}[1]{{\leavevmode\color{OliveGreen}[#1]}}

\newcommand{\noteprp}[1]{\note{\color{Blue}\textsc{prp:} #1}}
\newcommand{\notetk}[1]{\note{\color{Cyan}[\textsc{tk:} #1]}}

\newenvironment{beyond}{\vspace{-1ex}\em\begin{framed}\noindent}{\end{framed}\vspace{-1ex}}

%% % Make bibliography more space efficient
%% \let\oldthebibliography=\thebibliography
%% \let\endoldthebibliography=\endthebibliography
%% \renewenvironment{thebibliography}[1]{%
%%   \begin{oldthebibliography}{#1}%
%%     \setlength{\parskip}{2pt}\setlength{\itemsep}{0ex}%
%% }%
%% {%
%%   \end{oldthebibliography}%
%% }

\setlength{\bibspacing}{\baselineskip}

\setlist{itemsep=1pt, parsep=1pt}

\def\UrlFont{\footnotesize}

\newcommand{\stopindenting}{\parindent=0pt}

\newcommand{\eg}{e.g.,\xspace}
\newcommand{\ie}{i.e.,\xspace}
\newcommand{\etal}{et\ al.\xspace}
%\renewcommand{\figurename}{Fig.}
%\renewcommand{\tablename}{Tab.}
%\newcites{Bone}{References}

\renewcommand{\contentsname}{\underline{Table of Contents}}
\renewcommand{\cfttoctitlefont}{\hfill\bfseries}
\renewcommand{\cftaftertoctitle}{\hfill}
\renewcommand{\cftbeforesecskip}{2.5pt}

%% redefine framed environment to use open frames across pages
\setlength{\FrameSep}{5pt}
\newbox\openfboxbox
\newdimen\tmpofboxdim
\def\FirstFrameCommand{\fboxrule=\FrameRule\fboxsep=\FrameSep\openfboxf}
\def\MidFrameCommand{\fboxrule=\FrameRule\fboxsep=\FrameSep\openfboxm}
\def\LastFrameCommand{\fboxrule=\FrameRule\fboxsep=\FrameSep\openfboxl}

\long\def\doopenmbox{%
  \hbox{%
    \vrule width\fboxrule%
    \vbox{\vskip\fboxsep\box\openfboxbox\vskip\fboxsep}%
    \vrule width\fboxrule}}

\long\def\openfboxf#1{%
  \leavevmode
  \setbox\openfboxbox\hbox{\kern\fboxsep{#1}\kern\fboxsep}%
  \tmpofboxdim\fboxrule
  \advance\tmpofboxdim\fboxsep
  \advance\tmpofboxdim\dp\openfboxbox
  \hbox{%
    \lower\tmpofboxdim\hbox{%
      \vbox{%
        \hrule height\fboxrule
        \doopenmbox
      }%
    }%
  }%
}
\long\def\openfboxm#1{%
  \leavevmode
  \setbox\openfboxbox\hbox{\kern\fboxsep{#1}\kern\fboxsep}%
  \tmpofboxdim\fboxrule
  \advance\tmpofboxdim\fboxsep
  \advance\tmpofboxdim\dp\openfboxbox
  \hbox{%
    \lower\tmpofboxdim\hbox{%
      \vbox{%
        \doopenmbox
      }%
    }%
  }%
}
\long\def\openfboxl#1{%
  \leavevmode
  \setbox\openfboxbox\hbox{\kern\fboxsep{#1}\kern\fboxsep}%
  \tmpofboxdim\fboxrule
  \advance\tmpofboxdim\fboxsep
  \advance\tmpofboxdim\dp\openfboxbox
  \hbox{%
    \lower\tmpofboxdim\hbox{%
      \vbox{%
        \doopenmbox
        \hrule height\fboxrule
      }%
    }%
  }%
}


%% new environment: framed colored box
\newenvironment{fshaded}{%
\def\FrameCommand{\fboxsep=\FrameSep \fcolorbox{black}{shadecolor}}%
\MakeFramed {\FrameRestore}}%
{\endMakeFramed}

\newenvironment{cfshaded}{\vspace{-6pt}\begin{fshaded}}{\end{fshaded}\vspace{-6pt}}

\definecolor{shadecolor}{gray}{0.9}

\newenvironment{myitemize}{%
\begin{itemize}[leftmargin=2em, itemsep=0em, parsep=0em, topsep=0.1em,
    partopsep=0em]}
{\end{itemize}}

\newenvironment{myenumerate}{%
\begin{enumerate}[leftmargin=2em, itemsep=0em, parsep=0em, topsep=0.50em,
    partopsep=0em]}
{\end{enumerate}}

\newenvironment{structure}{\color{blue}\begin{myitemize}}{\end{myitemize}}
\newenvironment{structure*}{\color{blue}\begin{myenumerate}}{\end{myenumerate}}
\newenvironment{rawtext}{\color{OliveGreen}}{\color{black}}

\newcommand{\mypar}[1]{\medbreak\noindent\textbf{#1.}\quad}
\newcommand{\myparr}[1]{\medbreak\noindent\textbf{#1}\quad}
\newcommand{\para}[1]{\medbreak\noindent\textbf{#1}\quad}

% End

\bibliography{proposal.bib}
\AtEveryBibitem{% Clean up the bibtex rather than editing it
 \clearlist{address}
 \clearfield{date}
 \clearfield{eprint}
 \clearfield{isbn}
 \clearfield{issn}
 \clearlist{location}
 \clearfield{month}
 \clearfield{series}
 \clearfield{url}
 
 \ifentrytype{book}{}{% Remove publisher and editor except for books
  \clearlist{publisher}
  \clearname{editor}
 }
}

\setdescription{leftmargin=\parindent, labelindent=\parindent, itemsep=10pt}
\setlist{itemsep=0pt,topsep=3pt,parsep=0pt}

% table header
\definecolor{expertise-title}{gray}{1.0}
\newcommand{\tabhead}[1]{\cellcolor[gray]{0.4}\textcolor{expertise-title}{\noindent\textbf{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Custom Section counter:
%\makeatletter
%\newcounter{seccount}
%\setcounter{seccount}{0}
%\renewcommand{\section}[1]{
%  \stepcounter{seccount}
%  \noindent
%  \textbf{Section \theseccount: #1}
%  \addcontentsline{toc}{section}{Section \theseccount: #1}
%  \addtocounter{section}{1}
%  \setcounter{subsection}{0}
%  \setcounter{subsubsection}{0}
%}
%\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%% M.PASIN
%% Add named references
%% \customlabel{name-to-ref}{name-to-print}
%% works with Hiperref
%
% Example:
% This is the element \customlabel{e:management}{EMGT} ... bla bla ...
%  ...
% As you can see in \ref{e:management}, bla bla bla ...
%
\makeatletter
\newcommand{\customlabel}[2]{%
   \protected@write \@auxout {}{\string \newlabel {#1}{{#2}{\thepage}{#2}{#1}{}}}%
   \hypertarget{#1}{#2}
}
\newcommand{\@customlabel}[2]{%
   \protected@write \@auxout {}{\string \newlabel {#1}{{#2}{\thepage}{#2}{#1}{}}}%
   \hypertarget{#1}{}% {#2}
}
\newcommand{\dlabel}[1]{\@customlabel{#1}{\thedeliverable}}
\newcommand{\tlabel}[1]{\@customlabel{#1}{\thetask}}
\makeatother


%% M.PASIN
%% Work Package counters
%% SEE WP6 for an example

\newcounter{workpackage}
\setcounter{workpackage}{0}
\newcounter{deliverable}[workpackage]
\setcounter{deliverable}{0}
\newcounter{task}[workpackage]
\setcounter{task}{0}

\renewcommand{\theworkpackage}{WP\arabic{workpackage}}
\renewcommand{\thedeliverable}{D\arabic{workpackage}.\arabic{deliverable}}
\renewcommand{\thetask}{T\arabic{workpackage}.\arabic{task}}

\newcommand{\workpackage}{\refstepcounter{workpackage}\arabic{workpackage}}
\newcommand{\deliverable}[4]{\medskip\textbf{\refstepcounter{deliverable}\thedeliverable: #1} \hfill \textit{(#2, lead: #3, others: #4)}}
\newcommand{\task}[3]{\medskip\textbf{\refstepcounter{task}\thetask{} [#2] #1} \hfill \emph{(lead: #3)}}
